<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> BookNest - Profile </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <link rel="stylesheet" href="/css/profile.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>

</head>
<body>
<div class="ui padded stackable grid fluid ">

    <!-- NAV BAR -->
    <div class="ui menu">

        <div class="ui container">


            <div class ="nav-logo-container">
                <img src="/images/logo-beige.png" alt="BookNest Logo" class="nav-logo">
            </div>


            <div class="menu-items">
                <a href="/home/{{email}}" class="item">Home</a>
                <a href="/Discover/{{email}}" class="item">Discover</a>
                <a href="/nobel/{{email}}" class="item">Nobel Prize</a>
                <a href="/profile/{{email}}" class="item">Profile</a>
            </div>

            <div class="right menu">
                <div class="item">
                    <button  class="ui small button" id="signout-btn"> <a href="/joinbooknest"> Sign out </a> </button>
                </div>
            </div>
        </div>
    </div>


    <!-- BIO -->
    <div class="bio sixteen wide column" style="margin-top: 11vh">
        {{bio}}
    </div>

    <!-- FAVORITES -->
    <div class="three wide column">
        <div>
            <h3 class="ui header" style="margin-bottom:40px;margin-top:15px;color:#42322d"> {{displayname}}'s Favorites </h3>
            {{#favoritebooks}}
            <div class="book"> <img src={{thumbnailUrl}} alt="book-cover"
                                    onerror="this.onerror=null;
                                            this.src='https://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg';">
                <p style="margin-top: 10px;width:70%;font-weight: normal"> {{title}} </p> </div>

            {{/favoritebooks}}
        </div>
    </div>

    <!-- MAIN -->
    <div class="nine wide column">


        <div style="display:flex;justify-content: center;width:100%">
        <div class="ui buttons">
            <button class="ui button"  id="libraryButton" style="border-radius: 0;background-color: #c7b8ab;color:#42322d "> Library </button>
            <button class="ui button"   id="activityButton" style="border-radius: 0; background-color: #c7b8ab;color:#42322d" > Activity </button>
        </div>
        </div>



        <!-- library -->
        <div class="library"  id="library">
            <h2 class="ui header" style="color:#42322d"> {{displayname}}'s Library </h2>
            <h3 class="ui header">  Lost in the pages of...</h3>
            <div class="current-book" >
                {{#currentbooks}}
                <img src="{{thumbnailUrl}}" alt="book-cover" width="20%" height="20%" style="border-radius: 5px;"
                     onerror="this.onerror=null;
                             this.src='https://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg';">
                <div style="padding-right: 50px">
                <h4 class="ui header" style="color:#42322d" > {{title}} </h4>
                <p style="width:150px;"> by {{author}} </p>
                    <div class="ui progress" data-percent="{{progressBarPercentage}}" style="width:190px;">
                        <div class="bar">
                            <div class="progress"></div>
                        </div>
                    </div>
                    <button class="ui button update" onclick="currentlyReading({{{id}}})" style="border-radius: 0" >UPDATE</button>
                </div>
                {{/currentbooks}}

            </div>

            <h3 class="ui header"> Once upon a time I read... </h3>
            <div class="books">
                {{#alreadyread}}
                <div class="book"> <img src="{{thumbnailUrl}}" alt="book-cover" onerror="this.onerror=null;
                        this.src='https://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg';">
                    <p> {{title}} </p> </div>
                {{/alreadyread}}

            </div>

            <h3 class="ui header">Nightstand Novels </h3>
            <div class="books" style="margin-bottom: 0px;">
                {{#wanttoread}}
                <div class="book" style="padding-right: 15px"> <img src="{{thumbnailUrl}}" alt="book-cover" onerror="this.onerror=null;
                        this.src='https://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg';">
                    <p> {{title}} </p>
                </div>
                {{/wanttoread}}

            </div>

        </div>
        <!-- activity -->
        <div class="activity" id="activity">
            <h2 class="ui header" style="color:#42322d"> {{displayname}}'s Activity </h2>
            {{#reviews}}
            <div class="current-book" >
                <img src="{{thumbnailUrl}}" alt="book-cover" width="20%" height="20%" style="border-radius: 5px;"
                        onerror="this.onerror=null;
                        this.src='https://covers.openlibrary.org/b/isbn/{{isbn}}-M.jpg';">
                <div >
                    <h3 class="ui header" style="color:#42322d"> {{title}}</h3>
                    <p>by<i>  {{author}}</i></p>
                    <p> <b style="color:#42322d"> Description:</b> {{description}}</p>

                    <p> <b style="color:#42322d"> Book Completion:</b> {{endDate}}</p>

                    <p> <b style="color:#42322d"> Rating:</b> {{rating}}/5 stars</p>

                    <p style="font-style: italic"> <b style="color:#42322d"> @{{username}} </b> : {{review}} </p>

                </div>
            </div>
            {{/reviews}}{{^reviews}} <div class ="current-book"> Explore and leave some reviews! </div>{{/reviews}}




        </div>

    </div>



    <!-- PROFILE -->
    <div class="four wide column profile" >

            <div class="profile-container">

                <img class="ui medium circular image" src="{{#image}}{{image}}{{/image}}{{^image}}/images/square-image.jpg{{/image}}">

            </div>


            <div class="profile-content" >
                <h4 class="ui header"  > {{displayname}} </h4>

                <div>
                    <h4 class="ui header" >  Books Read </h4>
                <p>   {{numberofbooksread}} </p>
                </div>

                <div>
                    <h4 class="ui header" >  Favorite Genre  </h4>
                <p> {{romancecount}} </p>

                </div>

                <div>
                    <h4 class="ui header" >  Average Rating </h4>
                <p> {{avgrating}} </p>
                </div>
                <div>
                    <h4 class="ui header" >  Pages Read </h4>
                    <p> {{pagesread}} pages </p>
                </div>



        </div>
    </div>

    <!-- update currently reading -->
    <div class="ui modal" id="currently-reading-modal">
        <div class="header">Update Your Progress</div>
        <div class="content">
            <form id="currently-reading-form" class="ui form" method="post" >
                <div class="field">
                    <label for="pagesRead">Pages Read</label>
                    <input type="number" name="pagesRead" placeholder="Enter how many pages you've read">
                </div>
                <button class="ui button primary"  type="submit">Submit</button>
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="ui inverted  footer sixteen wide column">
        <div class="ui container" style="padding-top: 50px">
            <div class="ui stackable divided equal height stackable grid">
                <div class="four wide column">
                    <h4 class="ui inverted header">Connect With Us</h4>
                    <div class="ui  inverted link list">
                        <a href="#" class="item"><i class="facebook icon"></i> Facebook</a>
                        <a href="#" class="item"><i class="twitter icon"></i> Twitter</a>
                        <a href="#" class="item"><i class="instagram icon"></i> Instagram</a>
                    </div>
                </div>
                <div class="four wide column">
                    <h4 class="ui inverted header">Contact Us</h4>
                    <p>Email: booknest@gmail.com</p>
                    <p>Phone: +123 456 7890</p>
                </div>
                <div class="eight wide column">
                    <h4 class="ui inverted header">Newsletter</h4>
                    <p>Subscribe for updates on new book releases.</p>


                        <form action="/subscribe/{{email}}" method="post" class="ui action input" style="width: 100%;">
                            <input type="email" name="newsletteremail" placeholder="Your email..." required>
                            <button class="ui button" type="submit">Subscribe</button>
                        </form>
                    </div>
            </div>

            <!-- Modal for Subscription Feedback -->
            <div class="ui modal" id="subscription-modal">
                <div class="header" id="modal-header">Subscription</div>
                <div class="content">
                    <p id="modal-message">Thanks for subscribing!</p>
                </div>
                <div class="actions">
                    <div class="ui approve button">OK</div>
                </div>
            </div>


            <div class="ui center aligned container" style="padding-top: 20px;">
                <p>&#xa9; 2025 BookNest. All rights reserved.</p>
            </div>
        </div>

    </footer>

</div>
<script>
    const userEmail = "{{email}}";
    $(document).ready(function () {
        // Show Library and hide Activity
        $('#libraryButton').click(function () {
            $('.library').show();
            $('.activity').hide();
        });

        // Show Activity and hide Library
        $('#activityButton').click(function () {
            $('.library').hide();
            $('.activity').show();
        });

        $('.ui.progress').progress({
        }); // initializes an actual working progress bar where the class ui progress appears 

        const subscribed = '{{#subscribed}}true{{/subscribed}}';
        const subscribeFailed = '{{#subscribeFailed}}true{{/subscribeFailed}}';

        if (subscribed === 'true') {
            $('#modal-header').text("You're Subscribed!");
            $('#modal-message').text("Thanks for subscribing to BookNest ðŸŽ‰");
            $('#subscription-modal').modal('show');
        }

        if (subscribeFailed === 'true') {
            $('#modal-header').text("Already Subscribed");
            $('#modal-message').text("You're already on our list ðŸ˜Š No need to subscribe again.");
            $('#subscription-modal').modal('show');
        }

    });
// to update currently reading progress
    function currentlyReading(id){
        // creating a dynamic url, we need this because we cant define the url directly in the form as the id and email will constantly change
        const formAction = `/${userEmail}/${id}/UpdateCurrentlyReading`;
        // setting the forms action attribute to the dynamic url
        $("#currently-reading-form").attr("action", formAction);
        $("#currently-reading-modal").modal("show");
    }
</script>

</body>
</html>
